/**
 * Tree-sitter grammar for MiniLang
 * Generated by treelsp - do not edit manually
 */

module.exports = grammar({
  name: "MiniLang",

  word: $ => $.identifier,

  extras: $ => [
    /\s+/,
    $.comment
  ],

  rules: {
    program: $ => repeat($.statement),

    statement: $ => choice(
      $.global_var_decl,
      $.variable_decl,
      $.function_decl,
      $.return_statement,
      $.expr_statement
    ),

    global_var_decl: $ => seq(
      "var",
      field("name", $.identifier),
      "=",
      field("value", $.expression),
      ";"
    ),

    variable_decl: $ => seq(
      "let",
      field("name", $.identifier),
      "=",
      field("value", $.expression),
      ";"
    ),

    function_decl: $ => seq(
      "fn",
      field("name", $.identifier),
      "(",
      field("params", optional($.parameter_list)),
      ")",
      field("body", $.block)
    ),

    parameter_list: $ => seq(
      $.parameter,
      repeat(seq(
        ",",
        $.parameter
      ))
    ),

    parameter: $ => field("name", $.identifier),

    block: $ => seq(
      "{",
      repeat($.statement),
      "}"
    ),

    return_statement: $ => seq(
      "return",
      field("value", $.expression),
      ";"
    ),

    expr_statement: $ => seq(
      field("expr", $.expression),
      ";"
    ),

    expression: $ => choice(
      $.binary_expr,
      $.call_expr,
      $.identifier,
      $.number,
      $.string_literal
    ),

    call_expr: $ => prec(3, seq(
      field("callee", $.identifier),
      "(",
      field("args", optional($.argument_list)),
      ")"
    )),

    argument_list: $ => seq(
      $.expression,
      repeat(seq(
        ",",
        $.expression
      ))
    ),

    binary_expr: $ => choice(
      prec.left(1, seq(
        field("left", $.expression),
        field("op", "+"),
        field("right", $.expression)
      )),
      prec.left(1, seq(
        field("left", $.expression),
        field("op", "-"),
        field("right", $.expression)
      )),
      prec.left(2, seq(
        field("left", $.expression),
        field("op", "*"),
        field("right", $.expression)
      )),
      prec.left(2, seq(
        field("left", $.expression),
        field("op", "/"),
        field("right", $.expression)
      ))
    ),

    identifier: $ => token(/[a-zA-Z_][a-zA-Z0-9_]*/),

    number: $ => token(/[0-9]+/),

    string_literal: $ => token(/"[^"]*"/),

    comment: $ => token(/\/\/.*/)
  }
});
